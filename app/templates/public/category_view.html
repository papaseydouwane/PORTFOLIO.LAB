{% extends "base.html" %}

{% block title %}{{ category_name | capitalize }} — {{ portfolio.slug | upper }}{% endblock %}

{% block layout %}
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@1,300;1,600&family=Plus+Jakarta+Sans:wght@200;400;800&family=Space+Grotesk:wght@300;700&display=swap" rel="stylesheet">

<style>
    :root { 
        --primary: {{ portfolio.theme_config.get('primary_color', '#6366F1') }};
        --font-main: 'Plus Jakarta Sans', sans-serif;
        --font-accent: 'Cormorant Garamond', serif;
    }

    body { 
        font-family: var(--font-main); 
        background-color: #050505; 
        color: #ffffff;
        -webkit-font-smoothing: antialiased;
    }

    /* --- EFFET GRAIN SUBTIL --- */
    {% if portfolio.theme_config.get('show_grain') %}
    .noise::before {
        content: "";
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: url('https://grainy-gradients.vercel.app/noise.svg');
        opacity: 0.05;
        z-index: 9999;
        pointer-events: none;
    }
    {% endif %}

    .dynamic-card {
        transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        {% if portfolio.theme_config.get('card_style') == 'glass' %}
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 2.5rem;
        {% elif portfolio.theme_config.get('card_style') == 'brutalist' %}
        background: #ffffff;
        color: #000000;
        border: 4px solid #000000;
        box-shadow: 10px 10px 0px var(--primary);
        border-radius: 0px;
        {% else %}
        background: #111;
        border: 1px solid rgba(255,255,255,0.03);
        border-radius: 1.5rem;
        {% endif %}
    }

    .category-header {
        background: radial-gradient(circle at 100% 0%, var(--primary) -120%, transparent 50%);
    }

    .serif-italic {
        font-family: var(--font-accent);
        font-style: italic;
        font-weight: 300;
    }

    .btn-action {
        background: var(--primary);
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        overflow: hidden;
    }
    
    .btn-action:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 20px 40px -15px var(--primary);
        filter: brightness(1.1);
    }

    .vertical-text {
        writing-mode: vertical-rl;
        text-orientation: mixed;
    }
</style>

<div class="noise"></div>

<div class="min-h-screen flex flex-col">
    
    <nav class="py-10 px-6 sticky top-0 bg-[#050505]/60 backdrop-blur-xl z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <a href="{{ url_for('render.view_portfolio', slug=portfolio.slug) }}" class="group flex items-center gap-6 text-[10px] font-black uppercase tracking-[0.4em]">
                <div class="w-10 h-10 rounded-full border border-white/10 flex items-center justify-center group-hover:border-primary transition-colors">
                    <svg class="w-4 h-4 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" stroke-width="2"></path></svg>
                </div>
                Retour
            </a>
            <div class="flex items-center gap-4">
                <span class="text-[10px] font-bold uppercase tracking-widest opacity-30">Archive Digitale</span>
                <div class="h-[1px] w-12 bg-white/10"></div>
                <span class="text-[10px] font-bold uppercase tracking-widest text-primary italic">{{ category_name }}</span>
            </div>
        </div>
    </nav>

    <header class="category-header pt-32 pb-20 px-6 relative overflow-hidden">
        <div class="max-w-7xl mx-auto relative z-10">
            <div class="flex items-center gap-4 mb-8" data-aos="fade-right">
                <span class="w-12 h-[1px] bg-primary"></span>
                <span class="font-mono text-primary text-[10px] uppercase tracking-[0.5em]">Exploration</span>
            </div>
            <h1 class="text-[clamp(4rem,15vw,12rem)] font-black tracking-tighter leading-[0.8] mb-10" data-aos="fade-up">
                {{ category_name | upper }}<span class="text-primary italic">.</span>
            </h1>
            <p class="text-2xl md:text-4xl font-light text-white/40 max-w-3xl leading-tight" data-aos="fade-up" data-aos-delay="100">
                Une anthologie de mes <span class="serif-italic text-white underline decoration-primary/30 underline-offset-8">{{ category_name }}</span> les plus marquants.
            </p>
        </div>
        <div class="absolute -bottom-16 -right-16 text-[30vw] font-black text-white/[0.02] select-none pointer-events-none uppercase tracking-tighter">
            {{ category_name[:3] }}
        </div>
    </header>

    <main class="flex-grow py-32 px-6">
        <div class="max-w-7xl mx-auto">
            {% if not sections %}
                <div class="py-40 flex flex-col items-center justify-center border border-white/5 rounded-[4rem] bg-white/[0.01]">
                    <div class="w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-8 animate-pulse">
                        <svg class="w-8 h-8 text-white/20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" stroke-width="1.5"></path></svg>
                    </div>
                    <p class="text-white/20 italic font-serif text-3xl">Le chapitre est en cours d'écriture...</p>
                </div>
            {% endif %}

            <div class="space-y-24">
                {% for section in sections %}
                    
                    {% if category_name == 'projets' %}
                        <div class="dynamic-card overflow-hidden group" data-aos="fade-up">
                            <div class="grid md:grid-cols-2">
                                <div class="relative overflow-hidden aspect-[16/10] md:aspect-auto">
                                    <img src="{{ section.content.image_url or 'https://images.unsplash.com/photo-1614850523296-d8c1af93d400?q=80&w=2670&auto=format&fit=crop' }}" 
                                         class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105">
                                    <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors"></div>
                                </div>
                                <div class="p-12 md:p-20 flex flex-col justify-center">
                                    <div class="flex items-center gap-4 mb-8">
                                        <span class="text-[10px] font-mono text-primary tracking-[0.3em] uppercase">Projet {{ loop.index }}</span>
                                        <div class="h-[1px] flex-grow bg-white/5"></div>
                                    </div>
                                    <h2 class="text-5xl font-bold mb-8 leading-none tracking-tighter">{{ section.content.nom_projet }}</h2>
                                    <p class="text-white/40 text-xl leading-relaxed mb-12 font-light italic">"{{ section.content.description }}"</p>
                                    <a href="{{ section.content.url_demo }}" class="btn-action text-white px-12 py-5 rounded-full self-start font-black text-[10px] uppercase tracking-[0.2em] shadow-xl">
                                        Consulter l'étude
                                    </a>
                                </div>
                            </div>
                        </div>

                    {% elif category_name in ['formations', 'experiences'] %}
                        <div class="dynamic-card p-12 md:p-20 relative group overflow-hidden" data-aos="fade-up">
                            <div class="absolute top-0 right-0 p-12 hidden md:block">
                                <span class="text-[12rem] font-black text-white/[0.02] leading-none">{{ loop.index }}</span>
                            </div>
                            <div class="relative z-10">
                                <div class="flex flex-col md:flex-row justify-between items-start mb-12 gap-8">
                                    <div class="space-y-4">
                                        <div class="inline-flex items-center gap-3 px-4 py-1 rounded-full bg-primary/10 border border-primary/20">
                                            <span class="w-1.5 h-1.5 rounded-full bg-primary animate-pulse"></span>
                                            <span class="text-primary font-mono text-[10px] font-bold tracking-widest uppercase">{{ section.content.periode }}</span>
                                        </div>
                                        <h2 class="text-5xl font-bold tracking-tight max-w-xl">{{ section.content.diplome or section.content.poste }}</h2>
                                        <p class="text-2xl font-serif italic text-white/60">{{ section.content.ecole or section.content.entreprise }}</p>
                                    </div>
                                    <div class="w-20 h-20 rounded-full border border-white/10 flex items-center justify-center text-3xl group-hover:bg-primary group-hover:border-primary transition-all duration-500">
                                        {% if category_name == 'formations' %}
                                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 14l9-5-9-5-9 5 9 5z" stroke-width="1.5"></path><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" stroke-width="1.5"></path></svg>
                                        {% else %}
                                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke-width="1.5"></path></svg>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="max-w-3xl border-l-2 border-primary/20 pl-12 ml-4">
                                    <p class="text-xl text-white/50 leading-relaxed font-light italic">
                                        {{ section.content.cours or section.content.missions }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                {% endfor %}
            </div>
        </div>
    </main>

    <footer class="py-24 px-6 border-t border-white/5 mt-auto">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-12">
            <div class="flex flex-col items-center md:items-start gap-4">
                <p class="text-[10px] font-black uppercase tracking-[0.5em] opacity-20 text-center md:text-left">© 2026 {{ portfolio.slug | upper }} — FACTORY PRO STUDIO</p>
                <div class="flex gap-10 opacity-40 text-[9px] font-bold">
                    <a href="#" class="hover:text-primary transition-colors uppercase tracking-widest">Confidentialité</a>
                    <a href="#" class="hover:text-primary transition-colors uppercase tracking-widest">Mentions</a>
                </div>
            </div>
            <div class="flex gap-8">
                <div class="w-12 h-12 rounded-full border border-white/5 flex items-center justify-center hover:bg-white hover:text-black transition-all cursor-pointer">
                    <span class="text-[10px] font-bold">IN</span>
                </div>
                <div class="w-12 h-12 rounded-full border border-white/5 flex items-center justify-center hover:bg-white hover:text-black transition-all cursor-pointer">
                    <span class="text-[10px] font-bold">X</span>
                </div>
            </div>
        </div>
    </footer>
</div>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    AOS.init({ 
        duration: 1200, 
        once: true,
        easing: 'ease-out-quad'
    });
</script>
{% endblock %}